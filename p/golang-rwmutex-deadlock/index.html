<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ä»ä¸€ä¸ªé¢è¯•é¢˜å¼€å§‹æ·±å…¥äº†è§£ RWMutex ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´æ­»é”é—®é¢˜"><title>GO RWMutex ä¸­éšè—çš„æ­»é”é—®é¢˜</title><link rel=canonical href=https://jasonrd.github.io/blog/p/golang-rwmutex-deadlock/><link rel=stylesheet href=/blog/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="GO RWMutex ä¸­éšè—çš„æ­»é”é—®é¢˜"><meta property="og:description" content="ä»ä¸€ä¸ªé¢è¯•é¢˜å¼€å§‹æ·±å…¥äº†è§£ RWMutex ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´æ­»é”é—®é¢˜"><meta property="og:url" content="https://jasonrd.github.io/blog/p/golang-rwmutex-deadlock/"><meta property="og:site_name" content="jason's åšå®¢"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2021-11-09T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-09T00:00:00+00:00"><meta property="og:image" content="https://jasonrd.github.io/blog/p/golang-rwmutex-deadlock/daedlock.jpeg"><meta name=twitter:site content="@jasonxie666"><meta name=twitter:creator content="@jasonxie666"><meta name=twitter:title content="GO RWMutex ä¸­éšè—çš„æ­»é”é—®é¢˜"><meta name=twitter:description content="ä»ä¸€ä¸ªé¢è¯•é¢˜å¼€å§‹æ·±å…¥äº†è§£ RWMutex ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´æ­»é”é—®é¢˜"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jasonrd.github.io/blog/p/golang-rwmutex-deadlock/daedlock.jpeg"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/blog/><img src=/blog/img/avatar_hu92a1f0f4dac05816138a9efb01424f59_787601_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/blog>jason's åšå®¢</a></h1><h2 class=site-description>Welcom</h2></div></header><ol class=social-menu><li><a href=https://github.com/JasonRD target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/jasonxie666 target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>ä¸»é¡µ</span></a></li><li><a href=/blog/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>å…³äº</span></a></li><li><a href=/blog/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/blog/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/blog/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://jasonrd.github.io/blog/en/>English</option><option value=https://jasonrd.github.io/blog/ selected>ä¸­æ–‡</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#è¯»å†™é”å¼•å…¥>è¯»å†™é”å¼•å…¥</a></li><li><a href=#è¯»å†™é”åº•å±‚>è¯»å†™é”åº•å±‚</a><ol><li><a href=#è¯»é”é€»è¾‘>è¯»é”é€»è¾‘</a></li><li><a href=#å†™é”é€»è¾‘>å†™é”é€»è¾‘</a></li></ol></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/p/golang-rwmutex-deadlock/><img src=/blog/p/golang-rwmutex-deadlock/daedlock_hu26d071d1a9c611a8342c73b77f908c12_41977_800x0_resize_q75_box.jpeg srcset="/blog/p/golang-rwmutex-deadlock/daedlock_hu26d071d1a9c611a8342c73b77f908c12_41977_800x0_resize_q75_box.jpeg 800w, /blog/p/golang-rwmutex-deadlock/daedlock_hu26d071d1a9c611a8342c73b77f908c12_41977_1600x0_resize_q75_box.jpeg 1600w" width=800 height=370 loading=lazy alt="Featured image of post GO RWMutex ä¸­éšè—çš„æ­»é”é—®é¢˜"></a></div><div class=article-details><header class=article-category><a href=/blog/categories/golang/>golang</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/p/golang-rwmutex-deadlock/>GO RWMutex ä¸­éšè—çš„æ­»é”é—®é¢˜</a></h2><h3 class=article-subtitle>ä»ä¸€ä¸ªé¢è¯•é¢˜å¼€å§‹æ·±å…¥äº†è§£ RWMutex ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´æ­»é”é—®é¢˜</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Nov 09, 2021</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 4 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=è¯»å†™é”å¼•å…¥>è¯»å†™é”å¼•å…¥</h2><p>æœ‰ä¸‹é¢ä¸€æ®µç¨‹åºï¼Œé¢è¯•å®˜é—®è¿™æ®µç¨‹åºæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type Store struct {
</span></span><span class=line><span class=cl>    a string
</span></span><span class=line><span class=cl>    b string
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    sync.RWMutex
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>func (s *Store) GetA() string {
</span></span><span class=line><span class=cl>    fmt.Println(&#34;get a&#34;)
</span></span><span class=line><span class=cl>    s.RLock()
</span></span><span class=line><span class=cl>    fmt.Println(&#34;get a2&#34;)
</span></span><span class=line><span class=cl>    defer s.RUnlock()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return s.a
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>func (s *Store) GetAB() (string, string) {
</span></span><span class=line><span class=cl>    fmt.Println(&#34;get ab&#34;)
</span></span><span class=line><span class=cl>    s.RLock()
</span></span><span class=line><span class=cl>    fmt.Println(&#34;get ab2&#34;)
</span></span><span class=line><span class=cl>    defer s.RUnlock()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return s.GetA(), s.b
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>func (s *Store) Write(a, b string) {
</span></span><span class=line><span class=cl>    fmt.Println(&#34;write&#34;)
</span></span><span class=line><span class=cl>    s.Lock()
</span></span><span class=line><span class=cl>    defer s.Unlock()
</span></span><span class=line><span class=cl>    fmt.Println(&#34;write2&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    s.a = a
</span></span><span class=line><span class=cl>    s.b = b
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><ol><li>çœ‹åˆ°è¿™æ®µç¨‹åºç¨‹åºï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯è¯»å†™é”çš„é—®é¢˜ï¼›</li><li>å…¶æ¬¡ï¼Œçœ‹ Store è¿™ä¸ªç»“æ„ä½“ï¼Œå„ä¸ªå‡½æ•°éƒ½å®šä¹‰çš„æ˜¯æŒ‡é’ˆå‡½æ•°ã€‚é‚£å°±è¯´æ˜ï¼šä¸å­˜åœ¨è¯»å†™é”çš„ copy è¿‡ç¨‹ï¼›</li><li>GetAB æ–¹æ³•ä¸­é€šè¿‡è°ƒç”¨ GetA æ–¹æ³•ï¼Œåœ¨ <code>s.RUnlock</code> å‰é€šè¿‡è°ƒç”¨ <code>s.GetA</code>ï¼Œåˆåšäº†ä¸€æ¬¡è¯»å†™é”ä¸Šé” <code>s.RLock</code>ï¼Œä½†æ˜¯è¯»é”å¯ä»¥å¤šæ¬¡ä¸Šé”ï¼Œæ‰€ä»¥å•çœ‹è¿™é‡Œæ²¡ä»€ä¹ˆé—®é¢˜ï¼›</li><li>ç„¶åï¼Œæƒ³åˆ°ä¼šä¸ä¼š <code>Write</code> å’Œ <code>GetAB</code> å¹¶å‘è°ƒç”¨çš„æ—¶å€™ä¼šå­˜åœ¨é—®é¢˜å‘¢ï¼Ÿæ€è€ƒäº†ä¸€ä¼šï¼Œè§‰å¾—æ²¡é—®é¢˜ï¼Œå°±æ”¾å¼ƒäº†ã€‚</li></ol><p>ä»¥ä¸Šï¼Œæ˜¯é¢è¯•æ—¶æ•´ä¸ªæ€è·¯ã€‚</p><p>å›å¤´ï¼Œè¶Šæƒ³è¶Šè§‰å¾—è¿™é‡Œå“ªé‡Œæœ‰é—®é¢˜ï¼Œå°±åœ¨<code>å¤œè¯»ç¾¤</code>é‡Œæ±‚æ•™äº†ä¸€ä¸‹ï¼Œç¾¤é‡Œå¤§ç¥å‘äº†ä¸€ç¯‡<a class=link href=https://blog.csdn.net/xyz347/article/details/83902123 target=_blank rel=noopener>è¯»å†™é”ä¼˜å…ˆçº§çš„æ–‡ç« </a>ï¼Œç„¶åç»™äº†ä¸€æ®µæµ‹è¯•æ ·ä¾‹ï¼Œç¬é—´è±ç„¶å¼€æœ—ã€‚</p><p>mainå‡½æ•°é€»è¾‘å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func main() {
</span></span><span class=line><span class=cl>    store := Store{}
</span></span><span class=line><span class=cl>    wg := sync.WaitGroup{}
</span></span><span class=line><span class=cl>    wg.Add(2)
</span></span><span class=line><span class=cl>    go func() {
</span></span><span class=line><span class=cl>        defer wg.Done()
</span></span><span class=line><span class=cl>        for i := 1; i &lt; 10000; i += 1 {
</span></span><span class=line><span class=cl>            fmt.Println(&#34;main write &#34;, i)
</span></span><span class=line><span class=cl>            store.Write(&#34;111&#34;, &#34;1111&#34;)
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }()
</span></span><span class=line><span class=cl>    go func() {
</span></span><span class=line><span class=cl>        defer wg.Done()
</span></span><span class=line><span class=cl>        for i := 1; i &lt; 10000; i += 1 {
</span></span><span class=line><span class=cl>            fmt.Println(&#34;main get ab&#34;, i)
</span></span><span class=line><span class=cl>            store.GetAB()
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }()
</span></span><span class=line><span class=cl>    wg.Wait()
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>æ‰§è¡Œç»“æœ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>main get ab 12  //mainå‡½æ•°è¯»å–ab
</span></span><span class=line><span class=cl>get ab          //è¿›å…¥ s.GetAB å‡½æ•°
</span></span><span class=line><span class=cl>main write  1   //main å‡½æ•°å†™æ•°æ®
</span></span><span class=line><span class=cl>write           //è¿›å…¥ s.Write å‡½æ•°
</span></span><span class=line><span class=cl>write2          //è·å–å†™é”
</span></span><span class=line><span class=cl>main write  2
</span></span><span class=line><span class=cl>....            //å†™é”ä¸€ç›´æŠ¢å 
</span></span><span class=line><span class=cl>....
</span></span><span class=line><span class=cl>main write  13  //main å‡½æ•°å†™æ•°æ®
</span></span><span class=line><span class=cl>write           //è¿›å…¥ s.Write å‡½æ•°
</span></span><span class=line><span class=cl>write2          //è·å–å†™é”
</span></span><span class=line><span class=cl>main write  14  
</span></span><span class=line><span class=cl>write
</span></span><span class=line><span class=cl>write2
</span></span><span class=line><span class=cl>get ab2         //ä¹‹å‰ get ab 12 æ‰è·å¾—è¯»é”
</span></span><span class=line><span class=cl>get a           //è¿›å…¥ GetA 
</span></span><span class=line><span class=cl>get a2          //è·å–è¯»é”
</span></span><span class=line><span class=cl>main get ab 13  //mainå‡½æ•° get ab
</span></span><span class=line><span class=cl>get ab          //è¿›å…¥ s.GetAB å‡½æ•°
</span></span><span class=line><span class=cl>get ab2         //è·å–è¯»é”
</span></span><span class=line><span class=cl>main write  15  //æ³¨æ„âš ï¸ è¿™ä¸ªæ—¶å€™å†™æ•°æ®å¼€å§‹äº†
</span></span><span class=line><span class=cl>write           //è¿›å…¥ Write å‡½æ•°ï¼Œåé¢å°è¯•è·å–å†™é”
</span></span><span class=line><span class=cl>get a           //è¿™ä¸ªæ—¶å€™ GetAB è¿›å…¥äº† GetAï¼Œå°è¯•è·å–è¯»é”
</span></span><span class=line><span class=cl>fatal error: all goroutines are asleep - deadlock!  //å‡ºç°äº†æ­»é”
</span></span></code></pre></td></tr></table></div></div><p>åˆ†æï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    GetAB       |            GetA               |                Write
</span></span><span class=line><span class=cl>                |                               |
</span></span><span class=line><span class=cl>r0 å ç”¨è¯»é”      |                               |
</span></span><span class=line><span class=cl>                |                               |    w0 å°è¯•è·å–å†™é” ç­‰å¾…r0é‡Šæ”¾è¯»é”
</span></span><span class=line><span class=cl>                |   r1 å°è¯•è·å–è¯»é”ï¼Œæ’åœ¨w0åé¢     |
</span></span></code></pre></td></tr></table></div></div><p>ç”±äºè¯»å†™é”çš„ä¼˜å…ˆçº§ï¼Œè¯»é”å’Œå†™é”åŒæ—¶ç«äº‰æ—¶ï¼Œè¯»é”è¦æ’åœ¨å†™é”åé¢ï¼Œå¯¼è‡´äº† r1 ç«äº‰ w0çš„é”ï¼Œw0ç«äº‰r0ï¼Œr0æ‰§è¡Œä¸ä¸‹å»ï¼Œæœ€åæ­»é”ã€‚</p><h2 id=è¯»å†™é”åº•å±‚>è¯»å†™é”åº•å±‚</h2><p>è¯»å†™é”å‰ç½®æ¡ä»¶ï¼š</p><ol><li>è¯»å†™äº’æ–¥ï¼Œä½†æ˜¯è¯»è¯»ä¸äº’æ–¥ï¼›</li><li>è¯»ã€å†™é”éƒ½ä¸ä¼šå‡ºç°é¥¥é¥¿ï¼›</li><li>ä¿è¯è¯»ä¸Šé”æ•°é‡ä¸è§£é”æ•°é‡ä¸€è‡´ï¼›</li></ol><p>å¯ä»¥æ€è€ƒä¸‹ï¼Œå¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªè¿™æ ·çš„é”ï¼Œä½ ä¼šæ€ä¹ˆè®¾è®¡ï¼Ÿ</p><hr><p>goä¸­è¯»å†™é”çš„ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type RWMutex struct {
</span></span><span class=line><span class=cl>    w           Mutex  // ç”¨æ¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå†™é”èƒ½å¤ŸæŠ¢åˆ°é”
</span></span><span class=line><span class=cl>    writerSem   uint32 // å†™é”ä¿¡å·é‡ï¼Œåœ¨è¯»é”å…¨éƒ¨è§£é”æ—¶é€šçŸ¥é˜»å¡çš„å†™é”
</span></span><span class=line><span class=cl>    readerSem   uint32 // è¯»é”ä¿¡å·é‡ï¼Œåœ¨å†™é”è§£é”æ—¶é€šçŸ¥é˜»å¡çš„è¯»æ“ä½œ
</span></span><span class=line><span class=cl>    readerCount int32  // ç­‰å¾…ã€å·²ä¸Šé”çš„è¯»é”æ•°é‡
</span></span><span class=line><span class=cl>    readerWait  int32  // å†™é”è·å¾—é”å‰ï¼Œå·²ç»ä¸Šé”çš„è¯»é”æ•°é‡
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=è¯»é”é€»è¾‘>è¯»é”é€»è¾‘</h3><p>é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹è¯»ä¸Šé”é€»è¾‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func (rw *RWMutex) RLock() {
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    if atomic.AddInt32(&amp;rw.readerCount, 1) &lt; 0 {
</span></span><span class=line><span class=cl>        // A writer is pending, wait for it.
</span></span><span class=line><span class=cl>        runtime_SemacquireMutex(&amp;rw.readerSem, false)
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢ï¼Œä¸Šè¯»é”é€»è¾‘è·è¯•å›¾è·å–è¯»é”æ•°é‡åŸå­æ€§åŠ ä¸€ï¼š <code>atomic.AddInt32(&rw.readerCount, 1)</code>ã€‚è‡ªå¢æ“ä½œè¿”å›å€¼å¦‚æœå°äº0ï¼Œåˆ™é˜»å¡ç­‰å¾…ä¿¡å·é‡ <code>readerSem</code> å”¤é†’ã€‚</p><p>ç–‘é—®ï¼š</p><ol><li>ä»€ä¹ˆæƒ…å†µä¸‹ <code>readerCount</code> å°äº0ï¼›</li><li><code>runtime_SemacquireMutex</code> ä¸ä¼šé€ æˆè¯»è¯»äº’æ–¥ä¹ˆï¼Ÿ</li><li>å¦‚ä½•ä¿è¯è¯»ã€å†™äº’æ–¥ï¼Ÿ</li></ol><p>å†æ¥çœ‹ä¸€ä¸‹ï¼Œè¯»è§£é”é€»è¾‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func (rw *RWMutex) RUnlock() {
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    if r := atomic.AddInt32(&amp;rw.readerCount, -1); r &lt; 0 { 
</span></span><span class=line><span class=cl>        if r+1 == 0 || r+1 == -rwmutexMaxReaders {
</span></span><span class=line><span class=cl>            race.Enable()
</span></span><span class=line><span class=cl>            throw(&#34;sync: RUnlock of unlocked RWMutex&#34;)
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        // A writer is pending.
</span></span><span class=line><span class=cl>        if atomic.AddInt32(&amp;rw.readerWait, -1) == 0 {
</span></span><span class=line><span class=cl>            // The last reader unblocks the writer.
</span></span><span class=line><span class=cl>            runtime_Semrelease(&amp;rw.writerSem, false)
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>è§£é”é€»è¾‘ï¼šå…ˆå¯¹ <code>atomic.AddInt32(&rw.readerCount, -1)</code> è¿›è¡ŒåŸå­æ€§å‡ä¸€æ“ä½œã€‚</p><ul><li>rå¤§äº 0 ï¼šç›´æ¥é‡Šæ”¾é”å®Œæˆï¼›</li><li>rå°äº 0 ï¼šè¿›è¡Œè¯»é”æ•°é‡ä¸€è‡´æ€§åˆ¤æ–­ï¼Œ<code>atomic.AddInt32(&rw.readerWait, -1)</code> é’ˆå¯¹ <code>readerWait</code> åŸå­æ€§å‡ä¸€ååˆ¤æ–­æ˜¯å¦ä¸º 0ï¼Œä¸º 0 åˆ™å”¤èµ·å†™é”ä¿¡å·é‡ï¼›</li></ul><p>ä¸è¯»åŠ é”ç±»ä¼¼ï¼ŒåŒæ ·æœ‰ <code>atomic.AddInt32(&rw.readerCount, -1)</code> å°äº 0 åˆ¤æ–­ã€‚å¯ä»¥æœ‰ç»“è®º <code>rw.readerCount</code> å°äº 0ï¼Œä¸ºå†™é”ä¸Šé”çš„å……è¦æ¡ä»¶ï¼Œåé¢åˆ†æå†™é”æ—¶è¿›è¡ŒéªŒè¯ã€‚</p><p>è§£å†³äº†çš„é—®é¢˜ï¼š</p><ol><li>é‡Šæ”¾è¯»é”ï¼Œè¯»é”å…¨éƒ¨é‡Šæ”¾åå”¤èµ·å†™é”ï¼›</li><li>ä¸Šé”ä¸è§£é”æ•°é‡ä¸€è‡´æ€§ä¿è¯ï¼›</li></ol><p>ç–‘é—®ï¼š</p><ol><li><code>readerCount</code> ä¿®æ”¹æˆä¸€ä¸ªè´Ÿæ•°ï¼Ÿå¦‚ä½•ä¿è¯è¿™ä¸ªè´Ÿæ•°è¶³å¤Ÿå°å‘¢ï¼Ÿ</li></ol><h3 id=å†™é”é€»è¾‘>å†™é”é€»è¾‘</h3><p>å…ˆä¸Šä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func (rw *RWMutex) Lock() {
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    // First, resolve competition with other writers.
</span></span><span class=line><span class=cl>    rw.w.Lock()
</span></span><span class=line><span class=cl>    // Announce to readers there is a pending writer.
</span></span><span class=line><span class=cl>    r := atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders
</span></span><span class=line><span class=cl>    // Wait for active readers.
</span></span><span class=line><span class=cl>    if r != 0 &amp;&amp; atomic.AddInt32(&amp;rw.readerWait, r) != 0 {
</span></span><span class=line><span class=cl>        runtime_SemacquireMutex(&amp;rw.writerSem, false)
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>å†™ä¸Šé”é€»è¾‘ï¼š</p><ol><li>é¦–å…ˆï¼Œäº’æ–¥é‡ä¸Šé”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå†™é”åŠ é”æˆåŠŸã€‚</li><li>ç„¶åï¼Œä»¤ <code>readerCount</code> åŸå­æ€§å‡å» <code>rwmutexMaxReaders</code>ï¼ˆè¿™æ˜¯ä¸ªå¸¸é‡ï¼Œå…·ä½“å®šä¹‰ <code>const rwmutexMaxReaders = 1 &lt;&lt; 30</code>ï¼‰ã€‚è¿™é‡Œå¯ä»¥éªŒè¯ä¹‹å‰çŒœæƒ³ï¼Œ<code>rw.readerCount</code> å°äº0ï¼Œæ˜¯æŒæœ‰é”çš„å……è¦æ¡ä»¶ã€‚<ul><li><code>atomic.AddInt32(&rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders</code> è¿”å›ç»“æœæ˜¯åœ¨å†™é”è·å–å‰ï¼Œå·²æŒæœ‰è¯»é”çš„æ•°é‡ rã€‚<ul><li>r=0ï¼Œè¯´æ˜æ²¡æœ‰è¯»é”ï¼›</li><li>r&lt;0ï¼Œåªæœ‰åœ¨<code>è¯»è§£é”æ•°é‡>è¯»åŠ é”æ•°é‡</code>ï¼Œæˆ–å†™é”å¤šæ¬¡æ—¶å‘ç”Ÿï¼›ç¬¬ä¸€ä¸ªæƒ…å†µï¼Œè¯»è§£é”ä¼š <code>check</code>ï¼›ç¬¬äºŒç§æƒ…å†µï¼Œ<code>mutex</code> ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªå†™é”ï¼›</li><li>r>0ï¼Œå­˜åœ¨è¯»é”ï¼›</li></ul></li></ul></li><li>å†è¿›è¡Œ r!=0 åˆ¤æ–­ï¼ˆå³å­˜åœ¨è¯»é”ï¼‰ã€‚åŸå­æ€§æ“ä½œ <code>atomic.AddInt32(&rw.readerWait, r)</code>ï¼Œè®°å½•éœ€è¦ç­‰å¾…çš„è¯»é”æ•°é‡ï¼Œç„¶åç­‰å¾…<code>writerSem</code>å”¤é†’ã€‚</li></ol><p>æœ€ç»ˆï¼Œä¿è¯ï¼š1. å†™é”å”¯ä¸€æ€§ï¼›2. ç­‰å¾…è¯»é”å®Œå…¨é‡Šæ”¾ï¼›3. é˜»å¡åé¢è¯»é”çš„è·å–ï¼›</p><p>å†æ¥çœ‹ä¸€ä¸‹ï¼Œå†™é”è§£é”é€»è¾‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func (rw *RWMutex) Unlock() {
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    // Announce to readers there is no active writer.
</span></span><span class=line><span class=cl>    r := atomic.AddInt32(&amp;rw.readerCount, rwmutexMaxReaders)
</span></span><span class=line><span class=cl>    if r &gt;= rwmutexMaxReaders {
</span></span><span class=line><span class=cl>        race.Enable()
</span></span><span class=line><span class=cl>        throw(&#34;sync: Unlock of unlocked RWMutex&#34;)
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    // Unblock blocked readers, if any.
</span></span><span class=line><span class=cl>    for i := 0; i &lt; int(r); i++ {
</span></span><span class=line><span class=cl>        runtime_Semrelease(&amp;rw.readerSem, false)
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    // Allow other writers to proceed.
</span></span><span class=line><span class=cl>    rw.w.Unlock()
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>è§£é”é€»è¾‘ï¼š</p><ol><li>åŸå­æ€§æ“ä½œ <code>atomic.AddInt32(&rw.readerCount, rwmutexMaxReaders)</code>ã€‚è¿™é‡Œï¼Œèƒ½å¤Ÿçœ‹åˆ°ä¸¤ä¸ªéšå«çš„ç‚¹ï¼š<ul><li>åŸå­æ“ä½œç»“æŸåï¼Œå¦‚æœæœ‰å…¶ä»–è¯»é”è¯•å›¾è·å–è¯»é”ï¼Œä¸éœ€è¦é˜»å¡ï¼›</li><li>è¿™ä¸ªæ—¶å€™å…¶ä»–çº¿ç¨‹è¿˜æ˜¯ä¸èƒ½å¤Ÿè·å–å†™é”ï¼›</li><li>å³ï¼š<code>å†™é”é‡Šæ”¾é”æ—¶ï¼Œè¯»é”è¦æ¯”å†™é”ä¼˜å…ˆçº§é«˜</code>ï¼›</li></ul></li><li>åŸå­æ“ä½œè¿”å›å€¼ï¼Œæ˜¯å½“å‰è¯»é”æ•°é‡ã€‚åŒ…æ‹¬åœ¨å†™é”å‰è¯»é”ï¼ˆå†™é”æœªå®Œå…¨è·å¾—æƒ…å†µä¸‹å†™é”è§£é”ï¼‰ï¼Œå’Œå†™é”åé˜»å¡è¯»é”ï¼›ç„¶å <code>runtime_Semrelease</code> å”¤èµ·é˜»å¡ç€çš„è¯»é”ã€‚<ul><li><code>runtime_Semrelease > runtime_SemacquireMutex</code> ä¼šä¸ä¼šå­˜åœ¨é—®é¢˜ï¼ŸéªŒè¯è¿‡ä¸ä¼šã€‚</li></ul></li><li>ç„¶åå†™é”é‡Šæ”¾ï¼›</li></ol><h2 id=æ€»ç»“>æ€»ç»“</h2><p>é€šè¿‡åˆ†æï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼š</p><ol><li>å†™é”é‡Šæ”¾è¿‡ç¨‹ä¸­ï¼Œè¯»é”ä¼˜å…ˆçº§è¦é«˜äºå†™é”ï¼›</li><li>è¯»é”åŠ é”åï¼Œå†™é”å¯ä»¥è¿›å…¥åŠ é”è¿‡ç¨‹ï¼Œä½†æ˜¯è¦ç­‰å¾…ä¹‹å‰è¯»é”é‡Šæ”¾ï¼›å³ï¼Œå¹¶ä¸å°‘å†™é”ä¼˜å…ˆçº§é«˜äºå†™é”ï¼Œè€Œæ˜¯åœ¨<code>è¯»é”å·²ç»ä¸Šé”ï¼Œæˆ–æ²¡æœ‰æŒæœ‰è¯»å†™é”çš„åç¨‹</code>æ¡ä»¶ä¸‹ï¼Œè¯»å†™é”éƒ½æœ‰æœºä¼šè·å–é”ï¼›</li></ol><p>æ‰€ä»¥ï¼Œé’ˆå¯¹ä¹‹å‰çš„é¢è¯•é¢˜ï¼Œè¯»é”åµŒå¥—è¯»é”ï¼Œåœ¨æœ‰å†™é”çš„æ—¶å€™ï¼Œä¾æ®ç»“è®º2ä¼šå‘ç”Ÿæ­»é”ã€‚</p><p>é€šè¿‡ä¸Šé¢åˆ†æï¼Œå­˜åœ¨å¾…éªŒè¯é—®é¢˜ï¼š</p><ol><li><p><code>ä¸€ä¸ªåç¨‹ä¸ªå·²è·å–è¯»é”ï¼Œå¦ä¸ªåç¨‹è¯•å›¾è·å–å†™é”ï¼Œè¿˜æœ‰ä¸€ä¸ªåç¨‹åœ¨å®Œå…¨è·å–å†™é”å‰è°ƒç”¨Unlockï¼Œå†ä¸€ä¸ªåç¨‹é‡Šæ”¾è¯»é”ï¼ŒæŒ‰é¡ºåºè¿›è¡Œæµç¨‹</code>ã€‚ä¼šå‘ç”Ÿæ­»é”å…·ä½“å¯ä»¥è‡ªå·±åˆ†æï¼ˆå†™é”ä¿¡å·é‡æ°¸è¿œé˜»å¡ï¼‰ï¼›</p></li><li><p><code>ä¸€ä¸ªåç¨‹å·²ä¸Šå†™é”é”ï¼Œä¸€ä¸ªåç¨‹è¯•å›¾è·å–è¯»é”ï¼Œç„¶åå¦ä¸€ä¸ªåç¨‹é‡Šæ”¾è¯»é”ï¼Œæœ€åä¸€ä¸ªåç¨‹é‡Šæ”¾å†™é”</code>ï¼ŒåŒæ ·ä¼šå‘ç”Ÿæ­»é”ï¼ˆè¯»ä¿¡å·é‡æ°¸è¿œé˜»å¡ï¼‰ï¼›</p></li></ol><p>åœ¨ä»¥åç”¨é”çš„æ—¶å€™ä¸ç®¡æœ‰æ²¡æœ‰ä¼˜å…ˆçº§ï¼Œéƒ½è¦æ—¶åˆ»è®°ä½æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p><ol><li>äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚</li><li>é”çš„ä¸å¯æŠ¢å ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚</li><li>å æœ‰ä¸”ç­‰å¾…ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶: è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li></ol><h2 id=å‚è€ƒ>å‚è€ƒ</h2><ul><li>[sync.RWMutex]https://medium.com/golangspec/sync-rwmutex-ca6c6c3208a0</li></ul></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 jason's åšå®¢</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>